<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Hibernate Session</title>
    <meta name="description"
          content="Session interface is a single threaded object between Java application and the persistence layer. Session opens a single database connection when it is creat...">

    <!-- Begin Jekyll SEO tag v2.0.0 -->
<meta property="og:title" content="Hibernate Session" />
<meta name="description" content="Session interface is a single threaded object between Java application and the persistence layer. Session opens a single database connection when it is created, and holds onto it until the session is closed. It is mainly to offer CRUD operations on the persistent object which is loaded by Hibernate from the database." />
<meta property="og:description" content="Session interface is a single threaded object between Java application and the persistence layer. Session opens a single database connection when it is created, and holds onto it until the session is closed. It is mainly to offer CRUD operations on the persistent object which is loaded by Hibernate from the database." />
<link rel="canonical" href="http://localhost:4000/hibernate/Hibernate-Session/" />
<meta property="og:url" content="http://localhost:4000/hibernate/Hibernate-Session/" />
<meta property="og:site_name" content="汀汀涔涔" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-02-13T00:00:00+08:00" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "headline": "Hibernate Session",
    "datePublished": "2016-02-13T00:00:00+08:00",
    "description": "Session interface is a single threaded object between Java application and the persistence layer. Session opens a single database connection when it is created, and holds onto it until the session is closed. It is mainly to offer CRUD operations on the persistent object which is loaded by Hibernate from the database.",
    "url": "http://localhost:4000/hibernate/Hibernate-Session/"
  }
</script>
<!-- End Jekyll SEO tag -->

    <link rel="canonical" href="http://localhost:4000/hibernate/Hibernate-Session/">
    <link rel="alternate" type="application/rss+xml" title="汀汀涔涔" href="http://localhost:4000/feed.xml">

    <script type="text/javascript" src="/components/jquery/jquery.min.js"></script>

    <!-- Third-Party CSS -->
    <link rel="stylesheet" href="/components/bootstrap/css/bootstrap.min.css">

    <!-- My CSS -->
    <link rel="stylesheet" href="/assets/css/common.css">

    <!-- CSS set in page -->
    

    <!-- CSS set in layout -->
    
    <link rel="stylesheet" href="/assets/css/sidebar-post-nav.css">
    

    <script type="text/javascript" src="/components/bootstrap/js/bootstrap.min.js"></script>

</head>


    <body>

    <header class="site-header">
    <div class="container">
        <a id="site-header-brand" href="/" title="汀汀涔涔">
            <span class="octicon octicon-mark-github"></span> 汀汀涔涔
        </a>
        <nav class="site-header-nav" role="navigation">
            
            <a href="/"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="Home">
                Home
            </a>
            
            <a href="/open-source"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="Open-Source">
                Open-Source
            </a>
            
            <a href="/blog"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="Blog">
                Blog
            </a>
            
            <a href="/tags"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="Tags">
                Tags
            </a>
            
            <a href="/categories"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="Categories">
                Categories
            </a>
            
            <a href="/about"
               class=" site-header-nav-item hvr-underline-from-center"
               target=""
               title="About">
                About
            </a>
            
        </nav>
    </div>
</header>


        <div class="content">
            <section class="jumbotron geopattern" data-pattern-id="Hibernate Session">
    <div class="container">
        <div id="jumbotron-meta-info">
            <h1>Hibernate Session</h1>
            <span class="meta-info">
                
                
                <span class="octicon octicon-calendar"></span> 2016/02/13
                
                 |
                 Posted in Hibernate
                
                 |
                
                  <a href="/tags#hibernate" class="post-tag">
                      <span class="glyphicon glyphicon-tag small"></span> hibernate
                  </a>
                
                
            </span>
        </div>
    </div>
</section>
<script>
    $(document).ready(function(){

        $('.geopattern').each(function(){
            $(this).geopattern($(this).data('pattern-id'));
        });

    });
</script>
<article class="post container" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="row">

        <div class="col-md-8 markdown-body">

            <p>Session interface is a <strong>single threaded</strong> object between Java application and the persistence layer. Session opens a single database connection when it is created, and holds onto it until the session is closed. It is mainly to <strong>offer CRUD operations on the persistent object</strong> which is loaded by Hibernate from the database.</p>

<p>More details, in hibernate, Session interface wraps a JDBC connection, holds a mandatory (first-level) cache of persistent objects, allows Hibernate to automatically persist objects that are modified, and allows Hibernate to implement functionality such as lazy-loading.</p>

<h2 id="state-of-persistent-object">State of persistent object</h2>

<p>Persistent objects should be in one of the following three states at a given point in time:</p>

<ul>
  <li>
    <p><strong>transient</strong>: A new instance of a persistent class which is not associated with a Session and has no representation in the database and no identifier value. (ex. Person p = new Person). You can make a transient instance persistent by associating it with a Session.</p>
  </li>
  <li>
    <p><strong>persistent</strong>: A persistent instance has a representation in the database, an identifier value and is associated with a Session.</p>
  </li>
  <li>
    <p><strong>detached</strong>: Once we close the Hibernate Session, the persistent instance will become a detached instance. But the reference of the object is still valid. You could continue to modify the object. These changes will not lost and will be inserted into database when associated with a Session which changes it back to persistent state.</p>
  </li>
</ul>

<h2 id="open-a-session">Open a session</h2>

<blockquote>
  <p>Different version of Hibernate has different way to do it. The following is for Hibernate 4.3 only</p>
</blockquote>

<p>To open a session, it’s better to create an util class:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HibernateUtils</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="n">SessionFactory</span> <span class="n">sessionFactory</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="n">Session</span> <span class="n">session</span><span class="o">;</span>
	
	<span class="kd">static</span><span class="o">{</span>
		<span class="c1">// Loads hibernate.cfg.xml by default</span>
		<span class="n">Configuration</span> <span class="n">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Configuration</span><span class="o">().</span><span class="na">configure</span><span class="o">();</span>
		
		<span class="n">StandardServiceRegistryBuilder</span> <span class="n">ssrb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StandardServiceRegistryBuilder</span><span class="o">().</span><span class="na">applySettings</span><span class="o">(</span><span class="n">cfg</span><span class="o">.</span><span class="na">getProperties</span><span class="o">());</span>
		<span class="n">ServiceRegistry</span> <span class="n">service</span><span class="o">=</span><span class="n">ssrb</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
		<span class="n">sessionFactory</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="na">buildSessionFactory</span><span class="o">(</span><span class="n">service</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="cm">/**
	 * Get session
	 */</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="n">Session</span> <span class="nf">getSession</span><span class="o">(){</span>
		<span class="c1">// We could also use openSession()</span>
		<span class="k">return</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">getCurrentSession</span><span class="o">();</span>
	<span class="o">}</span>

	<span class="cm">/**
	 * Close session
	 */</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">closeSession</span><span class="o">(){</span>
		<span class="k">if</span><span class="o">(</span><span class="n">session</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">session</span><span class="o">.</span><span class="na">isOpen</span><span class="o">()){</span>
			<span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">closeSession</span><span class="o">(</span><span class="n">Session</span> <span class="n">session</span><span class="o">){</span>
		<span class="k">if</span><span class="o">(</span><span class="n">session</span><span class="o">!=</span><span class="kc">null</span><span class="o">&amp;&amp;</span><span class="n">session</span><span class="o">.</span><span class="na">isOpen</span><span class="o">()){</span>
			<span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>To use <code class="highlighter-rouge">getCurrentSession()</code>, it needs to add in hibernate.cfg.xml:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.current_session_context_class"</span><span class="nt">&gt;</span>thread<span class="nt">&lt;/property&gt;</span></code></pre></figure>

<h3 id="opensession-vs-getcurrentsession">openSession vs getCurrentSession</h3>

<h4 id="opensession">openSession()</h4>

<ol>
  <li>We can use it when we decided to manage the Session our self.</li>
  <li>It does not try to store or pull the session from the current context. Just a brand new one.</li>
  <li><strong>If we use this method, we need to <code class="highlighter-rouge">flush()</code> and <code class="highlighter-rouge">close()</code> the session. It does not flush and close() automatically</strong>.</li>
</ol>

<h4 id="getcurrentsession">getCurrentSession()</h4>

<p>The “CurrentSession” refers to a Hibernate Session bound by Hibernate behind the scenes, to the transaction scope. It <strong>creates a brand new session</strong> if does not exist or <strong>uses an existing one</strong> if one already exists. It automatically configured with both auto-flush and auto-close attributes as true means <strong>Session will be automatically flushed and closed</strong>. It’s better to use <code class="highlighter-rouge">getCurrentSession()</code> method when our transaction runs long time or with multi calls of session.</p>

<h2 id="save">save()</h2>

<p><code class="highlighter-rouge">save()</code> results in an SQL INSERT. It persists the given transient instance, first assigning a generated identifier. In brief, it adds/saves a new entity into database.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">HibernateUtils</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
<span class="n">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>

<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">();</span> 

<span class="n">user</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"DONGChuan"</span><span class="o">);</span> 
<span class="n">user</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">26</span><span class="o">);</span>

<span class="n">session</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>

<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="c1">// Because getCurrentSession(), so no need session.close();</span></code></pre></figure>
<p> </p>

<p>But be careful here, <code class="highlighter-rouge">save()</code> does not guarantee the same, it returns an identifier, and if an INSERT has to be executed to get the identifier, <strong>this INSERT happens immediately</strong>, no matter if you are inside or outside of a transaction. This is not good in a long-running conversation with an extended Session/persistence context.</p>

<h2 id="persist">persist()</h2>

<p><code class="highlighter-rouge">persist()</code> also makes a transient instance persistent. However, it doesn’t guarantee that the identifier value will be assigned to the persistent instance immediately, the assignment might happen at flush time. It also guarantees that it will not execute an <code class="highlighter-rouge">INSERT</code> statement if it is called outside of transaction boundaries. This is useful in long-running conversations with an extended Session/persistence context.</p>

<h2 id="load-and-get">load() and get()</h2>

<p><code class="highlighter-rouge">load()</code> and <code class="highlighter-rouge">get()</code> result in an SQL <code class="highlighter-rouge">SELECT BY ID</code>. It returns the persistent instance of the given entity class with the given identifier.(<code class="highlighter-rouge">load()</code> returna a “proxy”)</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">HibernateUtils</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
<span class="n">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>

<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span> <span class="c1">// 1 is the identifier in the database</span>
<span class="c1">// User user = (User) session.get(User.class, 1); </span>

<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="c1">// Because we use getCurrentSession, so no need to run session.close();</span></code></pre></figure>
<p> </p>

<h3 id="different-between-load-and-get">Different between load() and get()</h3>

<ul>
  <li>
    <p><code class="highlighter-rouge">load()</code> returns a <strong>“proxy” without hitting the database</strong> (lazy loading). In Hibernate, proxy is an object with the given identifier value, its properties are not initialized yet, it just look like a temporary fake object. If no row found , it will <strong>throws an exception</strong> - ObjectNotFoundException.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">get()</code> always <strong>hits the database and returns the real object</strong> instead of a proxy. If no row found , <strong>it return null</strong>.</p>
  </li>
</ul>

<h3 id="which-one-to-use">Which one to use</h3>

<p>If I’m not sure whether the object exists or not, I use <code class="highlighter-rouge">get()</code> to avoid an exception. If I’m sure, I prefer <code class="highlighter-rouge">load()</code>.</p>

<h2 id="update-and-saveorupdate">update() and saveOrUpdate()</h2>

<p>Which function will result in SQL <code class="highlighter-rouge">UPDATE</code>? We could find <code class="highlighter-rouge">update()</code> or <code class="highlighter-rouge">saveOrUpdate()</code>. But we need to know firstly, there is no need to call these functions to do update. When we <code class="highlighter-rouge">get()/load()</code> a persistent object, and then call setters to modify something. After transaction <code class="highlighter-rouge">commit()</code> or session <code class="highlighter-rouge">flush()</code>. Database will be updated.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">HibernateUtils</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
<span class="n">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>

<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
<span class="n">user</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">30</span><span class="o">);</span>

<span class="n">session</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
<span class="c1">// or tx.commit(); it does the same thing</span>
<span class="c1">// Because getCurrentSession(), so no need session.close();</span></code></pre></figure>
<p> </p>

<h3 id="update">update()</h3>

<p>So why we need <code class="highlighter-rouge">update()</code>? In fact, it’s mainly used to updated a detached object which was ever a persistent object and now session is closed. When <code class="highlighter-rouge">update()</code> a detached object, <strong>it will become persistent again</strong>.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">HibernateUtils</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
<span class="n">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>

<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>

<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="c1">// Because getCurrentSession(), so first session is closed here</span>

<span class="o">....</span>

<span class="c1">// Now user is in detached state. And we update it!</span>
<span class="n">user</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="mi">27</span><span class="o">));</span>

<span class="c1">// We open a second session</span>
<span class="n">Session</span> <span class="n">secondSession</span> <span class="o">=</span> <span class="n">HibernateUtils</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
<span class="n">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>

<span class="c1">// Update!</span>
<span class="n">secondSession</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>

<span class="c1">// Commit!</span>
<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="c1">// Because getCurrentSession(), so no need secondSession.close();</span></code></pre></figure>
<p> </p>

<h3 id="saveorupdate">saveOrUpdate()</h3>

<p>It means either <code class="highlighter-rouge">save()</code> or <code class="highlighter-rouge">update()</code> the given instance on the basis of identifier exists or not. When we are not sure whether the instance was ever persistent (so whether an identifier exists or not). USE IT! If the instance has an identifier, <code class="highlighter-rouge">update()</code> will be run to update it in databas. If no identifier, <code class="highlighter-rouge">save()</code> will be run to add an identifier and insert it into database.</p>

<h2 id="merge">merge()</h2>

<p><code class="highlighter-rouge">merge()</code> is also used to update a detached object. It copies the state of the given object onto the persistent object with the same identifier.</p>

<p>The difference with <code class="highlighter-rouge">update()</code> is that <code class="highlighter-rouge">update()</code> tries to reattach the instance, meaning that there is no other persistent object with the same identifier attached to the Session right now otherwise NonUniqueObjectException is thrown. <code class="highlighter-rouge">merge()</code>, however, just copies all values to a persistent instance in the Session (which will be loaded if it is not currently loaded). The input object is not changed. So merge is more general than <code class="highlighter-rouge">update()</code>, but may use more resources.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">HibernateUtils</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
<span class="n">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>

<span class="n">User</span> <span class="n">user1</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>

<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span> 
<span class="c1">// Because getCurrentSession(), so no need session.close();</span>

<span class="o">....</span>
<span class="n">user1</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="mi">30</span><span class="o">);</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">HibernateUtils</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span> 
<span class="n">tx</span><span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span> 

<span class="n">User</span> <span class="n">user2</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span> <span class="c1">// Same id as user1</span>

<span class="n">session</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">user1</span><span class="o">);</span> <span class="c1">// It throws NonUniqueObjectException because in the session, another persistent object with the same id already exists. user1 == user2 false</span>

<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="c1">// Because we use getCurrentSession, so no need session.close();</span></code></pre></figure>
<p> </p>

<p>So if in this situation, we should use <code class="highlighter-rouge">merge()</code>, it needs to merge user1 with user2:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">User</span> <span class="n">user2</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
<span class="n">User</span> <span class="n">user3</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">merge</span><span class="o">(</span><span class="n">user1</span><span class="o">);</span>

<span class="c1">// user3 == user2 true</span></code></pre></figure>
<p> </p>

<p>So here merge returns the <strong>same reference</strong> of user2.</p>

<h2 id="delete">delete()</h2>

<p><code class="highlighter-rouge">delete()</code> results in SQL <code class="highlighter-rouge">DELETE</code></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="n">HibernateUtils</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>
<span class="n">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>

<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">(</span><span class="n">User</span><span class="o">)</span> <span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
<span class="n">session</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>

<span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
<span class="c1">// Because getCurrentSession(), so no need session.close();</span></code></pre></figure>
<p> </p>

<h2 id="find">find()</h2>

<p>No <code class="highlighter-rouge">ind()</code> in current version! We must use query or criteria to achieve it.</p>

<h2 id="flush">flush()</h2>

<p><code class="highlighter-rouge">session.flush()</code> forces Hibernate to <strong>synchronize the in-memory state of the Session with the database</strong>.</p>

<p>By default, Hibernate will flush changes automatically for you:</p>

<ul>
  <li>Before some query executions</li>
  <li>When a transaction is committed</li>
</ul>

<p>We could also set flush mode, by default is AUTO:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// The Session is flushed before every query.</span>
<span class="n">session</span><span class="o">.</span><span class="na">setFlushMode</span><span class="o">(</span><span class="n">FlushMode</span><span class="o">.</span><span class="na">ALWAYS</span><span class="o">);</span>
<span class="c1">// The Session is sometimes flushed before query execution in order to ensure that queries never return stale state.</span>
<span class="n">session</span><span class="o">.</span><span class="na">setFlushMode</span><span class="o">(</span><span class="n">FlushMode</span><span class="o">.</span><span class="na">AUTO</span><span class="o">);</span>
<span class="c1">// The Session is flushed when Transaction.commit() is called. </span>
<span class="n">session</span><span class="o">.</span><span class="na">setFlushMode</span><span class="o">(</span><span class="n">FlushMode</span><span class="o">.</span><span class="na">COMMIT</span><span class="o">);</span>
<span class="c1">// The Session is only ever flushed when Session.flush() is explicitly called by the application.</span>
<span class="n">session</span><span class="o">.</span><span class="na">setFlushMode</span><span class="o">(</span><span class="n">FlushMode</span><span class="o">.</span><span class="na">MANUAL</span><span class="o">);</span></code></pre></figure>
<p> </p>

<p>Be careful, <strong>setFlushMode() must be invoked before session.beginTransaction()</strong>.</p>

<h2 id="ref">Ref</h2>

<ul>
  <li><a href="http://www.tutorialspoint.com/hibernate/hibernate_sessions.htm">Tutorialspoint - Point</a></li>
  <li><a href="https://docs.jboss.org/hibernate/orm/3.2/api/org/hibernate/Session.html">Hibernate API</a></li>
  <li><a href="http://stackoverflow.com/questions/5862680/whats-the-advantage-of-persist-vs-save-in-hibernate">Stackoverflow save() vs persist()</a></li>
</ul>


            <h3>Related Posts</h3>

            
            <a href="/android/Android-DragViewHelper/">Android DragViewHelper</a><br/>
            
            <a href="/android/Android-GestureDetector/">Android GestureDetector</a><br/>
            
            <a href="/android/Android-Shape/">Android Shape Drawable</a><br/>
            
            <a href="/android/Android-ListActivity/">Android ListActivity</a><br/>
            
            <a href="/android/Android-Fragment/">Android Fragment</a><br/>
            
            <a href="/android/Android-Toolbar/">Android Toolbar</a><br/>
            
            <a href="/css/CSS-Animation/">CSS Animation</a><br/>
            
            <a href="/mysql/MySQL-Index/">MySQL Index</a><br/>
            
            <a href="/mybatis/MyBatis-With-Spring/">MyBatis with Spring</a><br/>
            
            <a href="/mybatis/MyBatis-Advanced/">MyBatis association collection and discriminator</a><br/>
            
            <hr/>
            <div class="post-div">
                
                <a class="prev-link" href="/struts/Struts-Error-And-Message/"><span>&#8592;&#09;previous</span></a>
                
                <span class="nav-hint-mob"> You can also navigate with left [or] right arrows </span>
                
                <a class="next-link" href="/spring/Spring-Beans-Autowire/"><span>next&#09;&#8594;</span></a>
                
            </div>
            <!-- Comments -->
            <div class="comments">
    <div id="disqus_thread"></div>
    <script>
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//tt-cc.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
</div>

        </div>

        <div class="col-md-4">
            <div id="search">
    <form action="/search" method="get" class="input-group">
        <input type="text" id="search-query" class="form-control search-query" name="q" placeholder="Search"
               autocomplete="off">
        <span class="input-group-btn">
            <button class="btn btn-default" type="button">
                <span class="glyphicon glyphicon-search"></span>
            </button>
        </span>
    </form>
</div>

<section id="search-results" style="display:none">
    <header class="page-header">
        <h2>Search results</h2>
    </header>

    <div class="entries">
    </div>
</section>


<script id="search-results-template" type="text/mustache">
  {{#entries}}
    <article>
      <h6>
        {{#date}}<small><time datetime="{{pubdate}}" pubdate>{{displaydate}}</time></small>{{/date}}
        <a href="{{url}}">{{title}}</a>
      </h6>
      {{#is_post}}
      <ul>
        {{#tags}}<li>{{.}} </li>{{/tags}}
      </ul>
      {{/is_post}}
    </article>
  {{/entries}}
</script>



<script src="/components/search-jekyll/search.min.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
    $(function () {
        $('#search-query').lunrSearch({
            index: '/components/search-jekyll/index.json',
            results: '#search-results',
            entries: '.entries',
            template: '#search-results-template'
        });
    });
</script>

            <h3>Post Directory</h3>
<div id="post-directory-module">
<section class="post-directory">
    <!-- Links that trigger the jumping -->
    <!-- Added by javascript below -->
    <dl></dl>
</section>
</div>

<script type="text/javascript">

    $(document).ready(function(){
        $( "article h2" ).each(function( index ) {
            $(".post-directory dl").append("<dt><a class=\"jumper\" hre=#" +
                    $(this).attr("id")
                    + ">"
                    + $(this).text()
                    + "</a></dt>");

            var children = $(this).nextUntil("h2", "h3")

            children.each(function( index ) {
                $(".post-directory dl").append("<dd><a class=\"jumper\" hre=#" +
                        $(this).attr("id")
                        + ">"
                        + "&nbsp;&nbsp;- " + $(this).text()
                        + "</a></dd>");
            });
        });

        var fixmeTop = $('#post-directory-module').offset().top - 100;       // get initial position of the element

        $(window).scroll(function() {                  // assign scroll event listener

            var currentScroll = $(window).scrollTop(); // get current position

            if (currentScroll >= fixmeTop) {           // apply position: fixed if you
                $('#post-directory-module').css({      // scroll to that element or below it
                    top: '100px',
                    position: 'fixed',
                    width: 'inherit'
                });
            } else {                                   // apply position: static
                $('#post-directory-module').css({      // if you scroll above it
                    position: 'inherit',
                    width: 'inherit'
                });
            }

        });

        $("a.jumper").on("click", function( e ) {

            e.preventDefault();

            $("body, html").animate({
                scrollTop: ($( $(this).attr('hre') ).offset().top - 100)
            }, 600);

        });
    });

</script>
        </div>

    </div>

</article>

        </div>

    <footer class="container">

    <div class="site-footer">

        <div class="copyright pull-left">
            <!-- 请不要更改这一行 方便其他人知道模板的来源 谢谢 -->
            <!-- Please keep this line to let others know where this theme comes from. Thank you :D -->
            Power by <a href="https://github.com/DONGChuan/Yummy-Jekyll">Yummy Jekyll</a>
        </div>

        <a href="https://github.com/DONGChuan" target="_blank" aria-label="view source code">
            <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
        </a>

        <div class="pull-right">
            <a href="javascript:window.scrollTo(0,0)">TOP</a>
        </div>

    </div>

    <!-- Third-Party JS -->
    <script type="text/javascript" src="/components/geopattern/js/geopattern.min.js"></script>

    <!-- My JS -->
    <script type="text/javascript" src="/assets/js/script.js"></script>

    

    <!-- Google Analytics -->
    <div style="display:none">
        <script>
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r;
                i[r] = i[r] || function () {
                            (i[r].q = i[r].q || []).push(arguments)
                        }, i[r].l = 1 * new Date();
                a = s.createElement(o),
                        m = s.getElementsByTagName(o)[0];
                a.async = 1;
                a.src = g;
                m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
            ga('create', 'UA-79713062-1', 'auto');
            ga('send', 'pageview');
        </script>
    </div>

</footer>


    </body>

</html>
